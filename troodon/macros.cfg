[gcode_macro PRINT_START]
gcode:
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET={ params.HOTEND | default(210) }
    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={ params.BED | default(60) }
    BED_MESH_CLEAR
    G28
    QUAD_GANTRY_LEVEL
    G28
    BED_MESH_CALIBRATE
    PRINT_START4
    M109 S{ params.HOTEND | default(210) } ; wait for extruder temperature
    M190 S{ params.BED | default(60) } ; wait for bed temperature

[gcode_macro LOAD_FILAMENT]
gcode:
    M83                            ; set extruder to relative
    G1 E30 F300                    ; load
    G1 E15 F150                    ; prime nozzle with filament
    M82                            ; set extruder to absolute

[gcode_macro UNLOAD_FILAMENT]
gcode:
    M83                            ; set extruder to relative
    G1 E10 F300                    ; extrude a little to soften tip
    G1 E-40 F1800                  ; retract some, but not too much or it will jam
    M82                            ; set extruder to absolute

[gcode_macro M600]
gcode:
    PAUSE_MACRO
    UNLOAD

[gcode_macro SHUTDOWN]
gcode:
  {action_call_remote_method("shutdown_machine")}

[gcode_macro REBOOT]
gcode:
  {action_call_remote_method("reboot_machine")}
